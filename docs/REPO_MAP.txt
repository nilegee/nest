# Repository Structure Map
# FamilyNest - Zero-Build Family Hub (Current State)

## Root Structure
```
/index.html                     # CDN entry point (10.3KB) with Lit 3 + Iconify + Supabase
/README.md                      # Project documentation with current architecture overview
/AGENTS.md                      # Development guidelines and agent specifications (updated)
/ENHANCEMENT_SUGGESTIONS.md     # Comprehensive enhancement roadmap (NEW)
/.env.example                   # Environment variables template
/.gitignore                     # Git ignore rules
/package.json                   # Test dependencies only (jsdom for test runner)
/package-lock.json             # NPM lockfile (test dependencies)
```

## Source Code (`/src/`) - 2,867 total lines
```
/src/fn-app.js                  # Main application component with auth routing (148 lines)
/src/fn-landing.js             # Login view (Google OAuth + magic link) (187 lines)
/src/fn-home.js                # Dashboard shell with navigation and routing (891 lines)

## Phase 1 Views (562 lines)
/src/views/events-view.js       # Events management (EventAgent) (287 lines)
/src/views/feed-view.js         # Family Wall posts (FeedAgent) (275 lines)

## Phase 1 Components (427 lines)
/src/components/profile-overlay.js  # Profile display with stats (ProfileAgent) (346 lines)
/src/components/bottom-nav.js       # Mobile navigation component (81 lines)

## Phase 1 Cards (329 lines)
/src/cards/islamic-guidance-card.js # Islamic guidance widget (IslamicGuidanceAgent) (329 lines)

## Utilities (523 lines)
/src/utils/profile-utils.js     # Profile data helpers (523 lines)
```

## Database (`/supabase/`)
```
/supabase/migrations/
  20250816000000_init_schema.sql    # Single consolidated migration (397 lines)
                                    # Contains: 7 tables, RLS policies, indexes
                                    # Note: Violates MigrationAgent policy - needs refactoring
/supabase/schema_inferred.sql       # Complete schema definition (auto-generated)
/supabase/SCHEMA_MAP.md            # Database documentation
```

## Web Assets (`/web/`)
```
/web/supabaseClient.js          # Supabase client with sessionStorage persistence
/web/env.js                     # Auto-generated environment variables (sync-env.mjs)
                               # Contains: SUPABASE_URL, SUPABASE_ANON_KEY, WHITELISTED_EMAILS (4 emails)
```

## Testing (`/test/`) - 74 tests, 100% pass rate
```
/test/auth-flow-test.js         # Auth flow tests (9 tests) - whitelist, OAuth, magic link
/test/events-crud-test.js       # Events CRUD tests (14 tests) - create, read, update, delete
/test/feed-posting-test.js      # Feed posting tests (14 tests) - post creation, fetching
/test/profile-overlay-test.js   # Profile tests (19 tests) - display, stats, overlay states
/test/islamic-guidance-test.js  # Islamic guidance tests (18 tests) - content, fallbacks
```

## Scripts & Tools (`/scripts/`)
```
/scripts/sync-env.mjs           # Environment sync utility (generates web/env.js)
/scripts/test-runner.mjs        # Custom test runner with jsdom (no external frameworks)
/scripts/verify-*.sql           # Database verification scripts
/scripts/seed_minimal.sql       # Database seeding
```

## CI/CD (`/.github/`)
```
/.github/workflows/             # GitHub Actions workflows
/.github/docs/                  # CI documentation
```

## Documentation (`/docs/`)
```
/docs/REPO_MAP.txt             # This file - current repository structure guide
/docs/QA.md                    # Quality assurance checklist and smoke tests
/docs/RLS_FIX_README.md        # RLS policy fix documentation (403 error resolution)
```

## Legacy Database (`/db/`) - Preserved for reference
```
/db/schema.sql                  # Legacy schema file (superseded by migration)
/db/migration_familybot.sql     # FamilyBot features migration (historical)
```

## CI/CD (`/.github/`)
```
/.github/workflows/             # GitHub Actions workflows
/.github/docs/                  # CI documentation
```

## Documentation (`/docs/`)
```
/docs/REPO_MAP.txt             # This file - repository structure guide
```

## Current Architecture Overview

### Zero-Build CDN Approach ✅
- **Lit 3**: CDN-imported web components framework
- **Iconify**: Web component icons
- **Supabase JS v2**: Database and auth client
- **No bundling**: Direct ES module imports
- **GitHub Pages**: Static hosting

### Component Architecture
```
fn-app (auth router & session guard)
└── fn-landing (login: Google OAuth + magic link)
└── fn-home (dashboard shell with hash routing)
    ├── Sidebar Navigation (desktop ≥768px)
    ├── Bottom Navigation (mobile <768px)
    ├── Main Content Area
    │   ├── events-view (EventAgent) - CRUD operations
    │   ├── feed-view (FeedAgent) - post sharing
    │   └── dashboard (default view)
    │       └── islamic-guidance-card (IslamicGuidanceAgent) - daily wisdom
    └── profile-overlay (ProfileAgent) - modal component with stats
```

### Database Schema (Current State)
**Tables (7):**
- `families` - Family organization and settings
- `profiles` - User profiles (user_id PK, linked to auth.users)
- `events` - Family events (birthdays, anniversaries, custom)
- `posts` - Family Wall posts with media_url support
- `islamic_guidance` - Daily Islamic content (optional feature)
- `acts` - User activity tracking
- `feedback` - Family member feedback system
- `notes` - Family notes with checklist support

**Security:**
- **RLS Enabled**: All tables with family-scoped policies
- **Email Whitelist**: 4 authorized family emails
- **No localStorage**: Memory-only sessions
- **Family Isolation**: Data access strictly by family_id

### Test Coverage Status ✅
```
Auth Flow Tests:        9/9 passed  (whitelist, OAuth, magic link)
Events CRUD Tests:     14/14 passed (create, read, update, delete)
Feed Posting Tests:    14/14 passed (post creation, fetching, validation)
Profile Tests:         19/19 passed (display, stats, overlay management)
Islamic Guidance:      18/18 passed (content fetching, fallbacks)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Total:                 74/74 passed (100% pass rate)
```
- `events` - Family events with type classification
- `posts` - Family wall posts with media support
- `islamic_guidance` - Daily Islamic wisdom and guidance
- `profiles` - User profiles (inherited from baseline)
- `families` - Family organization (inherited from baseline)

### Integration Points
- All user names/photos are clickable → opens profile-overlay
- Navigation hash-based routing (#dashboard, #events, #feed)
- Profile overlay triggered by custom events from components
- Islamic guidance card is self-contained and removable

### File Dependencies
```
fn-home.js imports:
├── views/events-view.js
├── views/feed-view.js  
├── components/profile-overlay.js
└── cards/islamic-guidance-card.js

All components depend on:
├── Lit 3 (CDN)
├── Iconify icons (CDN)
└── supabaseClient.js
```